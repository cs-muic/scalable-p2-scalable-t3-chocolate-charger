FROM ubuntu:18.04 as builder

#install ffmpeg on our ubuntu
WORKDIR /app
ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get update && apt-get install -y ffmpeg

#also install imagemagick
RUN apt install imagemagick -y
RUN apt update


FROM python:3.9
ADD webcontroller /app 

RUN pip install poetry

COPY --from=builder /go/src/github.com/alexellis/href-counter/app ./
COPY webcontroller/pyproject.toml webcontroller/poetry.lock ./
RUN poetry install --no-root --no-dev

COPY webcontroller ./
RUN poetry install --no-dev

CMD ["poetry", "run", "python3", "extract.py"]
