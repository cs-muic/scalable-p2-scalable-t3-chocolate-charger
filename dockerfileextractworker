FROM ubuntu:18.04


#install ffmpeg on our ubuntu
ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get update && apt-get install -y ffmpeg
#also install imagemagick
RUN apt install imagemagick -y
RUN apt update 
RUN apt install software-properties-common -y
RUN add-apt-repository ppa:deadsnakes/ppa 
RUN apt update 
RUN apt install python3.9 -y
# RUN apt install python3-pip -y


ADD webcontroller /app 

RUN pip install poetry


COPY webcontroller/pyproject.toml webcontroller/poetry.lock ./
RUN poetry install --no-root --no-dev

COPY webcontroller ./
RUN poetry install --no-dev


CMD ["poetry", "run", "rq", "worker", "--url", "redis://redis:6379", "Extraction"]