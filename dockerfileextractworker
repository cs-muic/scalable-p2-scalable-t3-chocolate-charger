FROM ubuntu:18.04


#install ffmpeg on our ubuntu
WORKDIR /app
ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get update && apt-get install -y ffmpeg

#also install imagemagick
RUN apt install imagemagick -y


FROM python:3.9

RUN pip install poetry

WORKDIR /app


COPY webcontroller/pyproject.toml webcontroller/poetry.lock ./
RUN poetry install --no-root --no-dev

COPY webcontroller ./
RUN poetry install --no-dev


CMD ["flask", "run", "&&", "rq", "worker", "--url", "redis://redis:6379", "Extraction"]